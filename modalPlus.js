(()=>{const q=s=>Array.from(document.querySelectorAll(s));const fs=el=>{if(document.fullscreenElement)return document.exitFullscreen();(el.requestFullscreen||el.webkitRequestFullscreen||(()=>{})).call(el)};const ensure=()=>{q('.ventana .contenidoVentana').forEach(c=>{if(!c.querySelector('.btnFullVentana')){let b=document.createElement('button');b.type='button';b.className='btnFullVentana';b.setAttribute('aria-label','Pantalla completa');b.title='Pantalla completa';b.textContent='â›¶';c.appendChild(b)}if(!c.dataset.dragReady){c.dataset.dragReady='1';let h=c.querySelector('h2')||c;let st=null,ox=0,oy=0;const down=e=>{if(c.closest('.ventana')?.classList.contains('is-fullscreen'))return;st=c.getBoundingClientRect();ox=(e.touches?e.touches[0].clientX:e.clientX)-st.left;oy=(e.touches?e.touches[0].clientY:e.clientY)-st.top;c.style.transform='none';c.style.left=st.left+'px';c.style.top=st.top+'px';e.preventDefault()};const move=e=>{if(!st)return;let x=(e.touches?e.touches[0].clientX:e.clientX)-ox,y=(e.touches?e.touches[0].clientY:e.clientY)-oy;let maxX=window.innerWidth-c.offsetWidth-8,maxY=window.innerHeight-c.offsetHeight-8;if(x<8)x=8;if(y<8)y=8;if(x>maxX)x=maxX;if(y>maxY)y=maxY;c.style.left=x+'px';c.style.top=y+'px';e.preventDefault()};const up=()=>{st=null};h.addEventListener('mousedown',down);h.addEventListener('touchstart',down,{passive:false});window.addEventListener('mousemove',move);window.addEventListener('touchmove',move,{passive:false});window.addEventListener('mouseup',up);window.addEventListener('touchend',up)}})};
const hook=()=>{document.addEventListener('click',e=>{let b=e.target.closest('.btnFullVentana');if(b){let v=b.closest('.ventana');if(!v)return;v.classList.toggle('is-fullscreen');fs(v.querySelector('.contenidoVentana')||v);e.preventDefault();return}})};
window.addEventListener('DOMContentLoaded',()=>{ensure();hook()});
})();
